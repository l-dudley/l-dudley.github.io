import{S as Z,i as x,s as ee,e as T,t as K,c as k,a as D,h as P,d as h,b as I,f as A,g as C,H as E,j as te,k as j,N as le,m as q,I as se,O as ae,n as Q,w as re,P as ie}from"../chunks/index-949cf3b2.js";import{g as ne,a as oe}from"../chunks/db-c0070083.js";function X(b,l,t){const c=b.slice();return c[8]=l[t],c}function Y(b,l){var R,O;let t,c=((R=l[1][l[8].id])==null?void 0:R.firstName)+" "+((O=l[1][l[8].id])==null?void 0:O.lastName),H,_=`${l[8].left}px`,v=`${l[8].top}px`;return{key:b,first:null,c(){t=T("div"),H=K(c),this.h()},l(d){t=k(d,"DIV",{class:!0});var r=D(t);H=P(r,c),r.forEach(h),this.h()},h(){var d;I(t,"class","seat-box svelte-1pccs5y"),A(t,"left",_,!1),A(t,"top",v,!1),A(t,"background-color",(d=l[1][l[8].id])!=null&&d.valid?"white":"red",!1),this.first=t},m(d,r){C(d,t,r),E(t,H)},p(d,r){var s,n,a;l=d,r&3&&c!==(c=((s=l[1][l[8].id])==null?void 0:s.firstName)+" "+((n=l[1][l[8].id])==null?void 0:n.lastName))&&te(H,c),r&1&&_!==(_=`${l[8].left}px`)&&A(t,"left",_,!1),r&1&&v!==(v=`${l[8].top}px`)&&A(t,"top",v,!1),r&3&&A(t,"background-color",(a=l[1][l[8].id])!=null&&a.valid?"white":"red",!1)},d(d){d&&h(t)}}}function ce(b){let l,t,c,H,_,v,R,O,d,r,s,n,a,i,g,L,m,y,p=[],N=new Map,f,u,M=b[0];const F=e=>e[8].id;for(let e=0;e<M.length;e+=1){let o=X(b,M,e),S=F(o);N.set(S,p[e]=Y(S,o))}return{c(){l=j(),t=T("h2"),c=K("Generate Seating Chart"),H=j(),_=T("div"),v=T("div"),R=T("button"),O=K("Generate Chart"),d=j(),r=T("div"),s=T("h4"),n=K("Front"),a=j(),i=T("div"),g=T("h4"),L=K("Left"),m=j(),y=T("div");for(let e=0;e<p.length;e+=1)p[e].c();this.h()},l(e){le('[data-svelte="svelte-13jkzv9"]',document.head).forEach(h),l=q(e),t=k(e,"H2",{class:!0});var S=D(t);c=P(S,"Generate Seating Chart"),S.forEach(h),H=q(e),_=k(e,"DIV",{class:!0});var B=D(_);v=k(B,"DIV",{class:!0});var G=D(v);R=k(G,"BUTTON",{class:!0});var w=D(R);O=P(w,"Generate Chart"),w.forEach(h),G.forEach(h),B.forEach(h),d=q(e),r=k(e,"DIV",{class:!0});var V=D(r);s=k(V,"H4",{class:!0});var $=D(s);n=P($,"Front"),$.forEach(h),a=q(V),i=k(V,"DIV",{class:!0});var W=D(i);g=k(W,"H4",{class:!0});var U=D(g);L=P(U,"Left"),U.forEach(h),m=q(W),y=k(W,"DIV",{class:!0});var J=D(y);for(let z=0;z<p.length;z+=1)p[z].l(J);J.forEach(h),W.forEach(h),V.forEach(h),this.h()},h(){document.title="Generate Seating Chart",I(t,"class","title is-2"),I(R,"class","button is-primary"),I(v,"class","control"),I(_,"class","field is-grouped"),I(s,"class","title is-4 has-text-centered mb-0 front-heading svelte-1pccs5y"),I(g,"class","title is-4 has-text-centered left-heading svelte-1pccs5y"),I(y,"class","room-container svelte-1pccs5y"),I(i,"class","is-flex"),I(r,"class","box")},m(e,o){C(e,l,o),C(e,t,o),E(t,c),C(e,H,o),C(e,_,o),E(_,v),E(v,R),E(R,O),C(e,d,o),C(e,r,o),E(r,s),E(s,n),E(r,a),E(r,i),E(i,g),E(g,L),E(i,m),E(i,y);for(let S=0;S<p.length;S+=1)p[S].m(y,null);f||(u=se(R,"click",b[2]),f=!0)},p(e,[o]){o&3&&(M=e[0],p=ae(p,o,F,1,e,M,N,y,ie,Y,null,X))},i:Q,o:Q,d(e){e&&h(l),e&&h(t),e&&h(H),e&&h(_),e&&h(d),e&&h(r);for(let o=0;o<p.length;o+=1)p[o].d();f=!1,u()}}}function fe(b,l,t){let c=[],H=[],_={},v={};const R={front:0,right:1,back:2,left:3},O=({top:s,left:n})=>{let m=[];return s<200&&m.push("front"),s>600&&m.push("back"),n<700&&m.push("left"),n>700&&m.push("right"),m},d=(s,n,a)=>{const i=s.rules.filter(u=>u.type==="seat").map(u=>u.criteria);if(i&&i.length>0)return{seatId:i[0],valid:!0};const g=1e3,L=s.rules.filter(u=>u.type==="facing").map(u=>R[u.criteria]),m=s.rules.filter(u=>u.type==="location").map(u=>u.criteria);let y=Math.floor(Math.random()*a.length),p=!0,N=null,f=1;for(;p&&f<g;){const u=a[y];let M=[];u.group.forEach(G=>{const w=n[G],V=(w==null?void 0:w.rules.filter($=>$.type==="nogroup"))||[];M.push(V.map($=>$.criteria))}),N=a[y].id;const F=n[N],e=typeof F!="undefined"&&F!==null&&F!=="",o=M.flat().filter(G=>s.id===G).length>0,S=L.length>0?L[0]!=u.direction:!1,B=m.length>0?!v[N].includes(m[0]):!1;console.log(B),p=e||o||S||B,f+=1,y=Math.floor(Math.random()*a.length)}return{seatId:N,valid:!p}},r=()=>{let s={},n=[...c];H.sort((a,i)=>{var g=a.rules.filter(f=>f.type==="location").length,L=i.rules.filter(f=>f.type==="location").length,m=a.rules.filter(f=>f.type==="facing").length,y=i.rules.filter(f=>f.type==="facing").length,p=a.rules.filter(f=>f.type==="seat").length,N=a.rules.filter(f=>f.type==="seat").length;return p>N||g>L||m>y?-1:i.rules.length-a.rules.length}).forEach(a=>{const{seatId:i,valid:g}=d(a,s,n);i!==null&&(a.valid=g,s[i]=a,n=n.filter(L=>L.id!==i))}),c.forEach(a=>{a.id in s||(s[a.id]={firstName:"Empty",lastName:"Seat",valid:!0})}),t(1,_=s)};return re(async()=>{t(0,c=await ne()),H=await oe();let s={};v={},c.forEach(n=>{s[n.id]={firstName:"Empty",lastName:"Seat",valid:!0},v[n.id]=O(n)}),t(1,_=s)}),[c,_,r]}class de extends Z{constructor(l){super(),x(this,l,fe,ce,ee,{})}}export{de as default};
