import{S as Z,i as x,s as ee,e as b,t as A,c as k,a as D,h as K,d as h,b as O,f as B,g as M,H as g,j as te,k as j,N as le,m as q,I as se,O as ae,n as Q,w as re,P as ie}from"../chunks/index-949cf3b2.js";import{g as ne,a as oe}from"../chunks/db-a022f0f9.js";function X(F,l,s){const u=F.slice();return u[9]=l[s],u}function Y(F,l){var y,I;let s,u=((y=l[1][l[9].id])==null?void 0:y.firstName)+" "+((I=l[1][l[9].id])==null?void 0:I.lastName),m,p=`${l[9].left}px`,_=`${l[9].top}px`;return{key:F,first:null,c(){s=b("div"),m=A(u),this.h()},l(v){s=k(v,"DIV",{class:!0});var n=D(s);m=K(n,u),n.forEach(h),this.h()},h(){O(s,"class","seat-box svelte-1pccs5y"),B(s,"left",p,!1),B(s,"top",_,!1),B(s,"background-color",l[2](l[1][l[9].id]),!1),this.first=s},m(v,n){M(v,s,n),g(s,m)},p(v,n){var H,a;l=v,n&3&&u!==(u=((H=l[1][l[9].id])==null?void 0:H.firstName)+" "+((a=l[1][l[9].id])==null?void 0:a.lastName))&&te(m,u),n&1&&p!==(p=`${l[9].left}px`)&&B(s,"left",p,!1),n&1&&_!==(_=`${l[9].top}px`)&&B(s,"top",_,!1),n&3&&B(s,"background-color",l[2](l[1][l[9].id]),!1)},d(v){v&&h(s)}}}function ce(F){let l,s,u,m,p,_,y,I,v,n,H,a,i,r,o,R,S,c,d=[],T=new Map,E,t,C=F[0];const G=e=>e[9].id;for(let e=0;e<C.length;e+=1){let f=X(F,C,e),L=G(f);T.set(L,d[e]=Y(L,f))}return{c(){l=j(),s=b("h2"),u=A("Generate Seating Chart"),m=j(),p=b("div"),_=b("div"),y=b("button"),I=A("Generate Chart"),v=j(),n=b("div"),H=b("h4"),a=A("Front"),i=j(),r=b("div"),o=b("h4"),R=A("Left"),S=j(),c=b("div");for(let e=0;e<d.length;e+=1)d[e].c();this.h()},l(e){le('[data-svelte="svelte-13jkzv9"]',document.head).forEach(h),l=q(e),s=k(e,"H2",{class:!0});var L=D(s);u=K(L,"Generate Seating Chart"),L.forEach(h),m=q(e),p=k(e,"DIV",{class:!0});var P=D(p);_=k(P,"DIV",{class:!0});var N=D(_);y=k(N,"BUTTON",{class:!0});var w=D(y);I=K(w,"Generate Chart"),w.forEach(h),N.forEach(h),P.forEach(h),v=q(e),n=k(e,"DIV",{class:!0});var V=D(n);H=k(V,"H4",{class:!0});var $=D(H);a=K($,"Front"),$.forEach(h),i=q(V),r=k(V,"DIV",{class:!0});var W=D(r);o=k(W,"H4",{class:!0});var U=D(o);R=K(U,"Left"),U.forEach(h),S=q(W),c=k(W,"DIV",{class:!0});var J=D(c);for(let z=0;z<d.length;z+=1)d[z].l(J);J.forEach(h),W.forEach(h),V.forEach(h),this.h()},h(){document.title="Generate Seating Chart",O(s,"class","title is-2"),O(y,"class","button is-primary"),O(_,"class","control"),O(p,"class","field is-grouped"),O(H,"class","title is-4 has-text-centered mb-0 front-heading svelte-1pccs5y"),O(o,"class","title is-4 has-text-centered left-heading svelte-1pccs5y"),O(c,"class","room-container svelte-1pccs5y"),O(r,"class","is-flex"),O(n,"class","box")},m(e,f){M(e,l,f),M(e,s,f),g(s,u),M(e,m,f),M(e,p,f),g(p,_),g(_,y),g(y,I),M(e,v,f),M(e,n,f),g(n,H),g(H,a),g(n,i),g(n,r),g(r,o),g(o,R),g(r,S),g(r,c);for(let L=0;L<d.length;L+=1)d[L].m(c,null);E||(t=se(y,"click",F[3]),E=!0)},p(e,[f]){f&7&&(C=e[0],d=ae(d,f,G,1,e,C,T,c,ie,Y,null,X))},i:Q,o:Q,d(e){e&&h(l),e&&h(s),e&&h(m),e&&h(p),e&&h(v),e&&h(n);for(let f=0;f<d.length;f+=1)d[f].d();E=!1,t()}}}function fe(F,l,s){let u=[],m=[],p={},_={};const y={front:0,right:1,back:2,left:3},I=a=>{let i="white";return a&&(a.valid?a.empty?i="white":i="lightgreen":i="#FF4F40"),i},v=({top:a,left:i})=>{let c=[];return a<200&&c.push("front"),a>600&&c.push("back"),i<700&&c.push("left"),i>700&&c.push("right"),c},n=(a,i,r)=>{const o=a.rules.filter(t=>t.type==="seat").map(t=>t.criteria);if(o&&o.length>0)return{seatId:o[0],valid:!0};const R=a.rules.filter(t=>t.type==="facing").map(t=>y[t.criteria]),S=a.rules.filter(t=>t.type==="location").map(t=>t.criteria);let c=Math.floor(Math.random()*r.length),d=!0,T=null,E=[...r];for(;d&&E.length>0;){const t=E[c];let C=[];t.group.forEach(N=>{const w=i[N],V=(w==null?void 0:w.rules.filter($=>$.type==="nogroup"))||[];C.push(V.map($=>$.criteria))}),T=E[c].id;const G=i[T],e=typeof G!="undefined"&&G!==null&&G!=="",f=C.flat().filter(N=>a.id===N).length>0,L=R.length>0?R[0]!=t.direction:!1,P=S.length>0?!_[T].includes(S[0]):!1;d=e||f||L||P,E=E.filter(N=>N.id!==T),c=Math.floor(Math.random()*E.length)}return{seatId:T,valid:!d}},H=()=>{let a={},i=[...u];m.sort((r,o)=>{var R=r.rules.filter(t=>t.type==="location").length,S=o.rules.filter(t=>t.type==="location").length,c=r.rules.filter(t=>t.type==="facing").length,d=o.rules.filter(t=>t.type==="facing").length,T=r.rules.filter(t=>t.type==="seat").length,E=r.rules.filter(t=>t.type==="seat").length;return T>E||R>S||c>d?-1:o.rules.length-r.rules.length}).forEach(r=>{console.log(r);const{seatId:o,valid:R}=n(r,a,i);o!==null&&(r.valid=R,r.empty=!1,a[o]=r,i=i.filter(S=>S.id!==o))}),u.forEach(r=>{r.id in a||(a[r.id]={firstName:"Empty",lastName:"Seat",valid:!0,empty:!0})}),s(1,p=a)};return re(async()=>{s(0,u=await ne()),m=await oe();let a={};_={},u.forEach(i=>{a[i.id]={firstName:"Empty",lastName:"Seat",valid:!0,empty:!0},_[i.id]=v(i)}),s(1,p=a)}),[u,p,I,H]}class de extends Z{constructor(l){super(),x(this,l,fe,ce,ee,{})}}export{de as default};
