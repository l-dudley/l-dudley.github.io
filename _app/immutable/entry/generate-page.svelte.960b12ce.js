import{S as ae,i as ie,s as re,x as ne,M as oe,a as z,k as O,r as Q,z as ce,N as ue,h as f,c as B,l as C,m as N,u as U,A as fe,p as I,O as de,b as V,F as R,B as he,P as pe,G as _e,Q as me,R as ge,g as ve,d as ye,C as Ee,o as Re,q as P,v as be,T as Se}from"../chunks/index.35c0646e.js";import{g as He,a as ke,b as Le}from"../chunks/db.181fcdef.js";import{S as Te}from"../chunks/SelectField.cc9fa960.js";function le(d,s,t){const h=d.slice();return h[16]=s[t],h}function se(d,s){var H,S;let t,h=((H=s[3][s[16].id])==null?void 0:H.firstName)+" "+((S=s[3][s[16].id])==null?void 0:S.lastName),b,g,p=`${s[16].left}px`,v=`${s[16].top}px`;return{key:d,first:null,c(){t=O("div"),b=Q(h),g=z(),this.h()},l(c){t=C(c,"DIV",{class:!0});var _=N(t);b=U(_,h),g=B(_),_.forEach(f),this.h()},h(){I(t,"class","seat-box svelte-a2eqnd"),P(t,"left",p),P(t,"top",v),P(t,"background-color",s[6](s[3][s[16].id])),this.first=t},m(c,_){V(c,t,_),R(t,b),R(t,g)},p(c,_){var w,E;s=c,_&12&&h!==(h=((w=s[3][s[16].id])==null?void 0:w.firstName)+" "+((E=s[3][s[16].id])==null?void 0:E.lastName))&&be(b,h),_&4&&p!==(p=`${s[16].left}px`)&&P(t,"left",p),_&4&&v!==(v=`${s[16].top}px`)&&P(t,"top",v),_&12&&P(t,"background-color",s[6](s[3][s[16].id]))},d(c){c&&f(t)}}}function De(d){let s,t,h,b,g,p,v,H,S,c,_,w,E,M,W,K,L,a,o,i,r,u=[],T=new Map,m,D,F,k;function l(e){d[9](e)}let j={fullwidth:"true",options:d[5],onChange:d[8]};d[4]!==void 0&&(j.value=d[4]),c=new Te({props:j}),ne.push(()=>oe(c,"value",l));let G=d[2];const X=e=>e[16].id;for(let e=0;e<G.length;e+=1){let n=le(d,G,e),y=X(n);T.set(y,u[e]=se(y,n))}return{c(){s=z(),t=O("h2"),h=Q("Generate Seating Chart"),b=z(),g=O("div"),p=O("div"),v=O("button"),H=Q("Generate Chart"),S=z(),ce(c.$$.fragment),w=z(),E=O("div"),M=O("h4"),W=Q("Front"),K=z(),L=O("div"),a=O("h4"),o=Q("Left"),i=z(),r=O("div");for(let e=0;e<u.length;e+=1)u[e].c();this.h()},l(e){ue("svelte-3kq8j0",document.head).forEach(f),s=B(e),t=C(e,"H2",{class:!0});var y=N(t);h=U(y,"Generate Seating Chart"),y.forEach(f),b=B(e),g=C(e,"DIV",{class:!0});var q=N(g);p=C(q,"DIV",{class:!0});var A=N(p);v=C(A,"BUTTON",{class:!0});var J=N(v);H=U(J,"Generate Chart"),J.forEach(f),A.forEach(f),q.forEach(f),S=B(e),fe(c.$$.fragment,e),w=B(e),E=C(e,"DIV",{class:!0});var $=N(E);M=C($,"H4",{class:!0});var x=N(M);W=U(x,"Front"),x.forEach(f),K=B($),L=C($,"DIV",{class:!0});var Y=N(L);a=C(Y,"H4",{class:!0});var ee=N(a);o=U(ee,"Left"),ee.forEach(f),i=B(Y),r=C(Y,"DIV",{class:!0});var te=N(r);for(let Z=0;Z<u.length;Z+=1)u[Z].l(te);te.forEach(f),Y.forEach(f),$.forEach(f),this.h()},h(){document.title="Generate Seating Chart",I(t,"class","title is-2"),I(v,"class","button is-primary"),I(p,"class","control"),I(g,"class","field is-grouped"),I(M,"class","title is-4 has-text-centered mb-0 front-heading svelte-a2eqnd"),I(a,"class","title is-4 has-text-centered left-heading svelte-a2eqnd"),I(r,"class","room-container svelte-a2eqnd"),de(()=>d[10].call(r)),I(L,"class","is-flex"),I(E,"class","box")},m(e,n){V(e,s,n),V(e,t,n),R(t,h),V(e,b,n),V(e,g,n),R(g,p),R(p,v),R(v,H),V(e,S,n),he(c,e,n),V(e,w,n),V(e,E,n),R(E,M),R(M,W),R(E,K),R(E,L),R(L,a),R(a,o),R(L,i),R(L,r);for(let y=0;y<u.length;y+=1)u[y].m(r,null);m=pe(r,d[10].bind(r)),D=!0,F||(k=_e(v,"click",d[7]),F=!0)},p(e,[n]){const y={};n&32&&(y.options=e[5]),!_&&n&16&&(_=!0,y.value=e[4],me(()=>_=!1)),c.$set(y),n&76&&(G=e[2],u=ge(u,n,X,1,e,G,T,r,Se,se,null,le))},i(e){D||(ve(c.$$.fragment,e),D=!0)},o(e){ye(c.$$.fragment,e),D=!1},d(e){e&&f(s),e&&f(t),e&&f(b),e&&f(g),e&&f(S),Ee(c,e),e&&f(w),e&&f(E);for(let n=0;n<u.length;n+=1)u[n].d();m(),F=!1,k()}}}function Fe(d,s,t){let h=[],b=[],g={},p=1,v=[],H=0,S=0;const c={front:0,right:1,back:2,left:3},_=a=>{let o="white";return a&&(a.valid?a.empty?o="white":o="lightgreen":o="#FF4F40"),o},w=({top:a,left:o})=>{let m=[];return a<200&&m.push("front"),a>600&&m.push("back"),o<700&&m.push("left"),o>700&&m.push("right"),m},E=(a,o,i)=>{const r=a.rules.filter(l=>l.type==="seat").map(l=>l.criteria);if(r&&r.length>0)return{seatId:r[0],valid:!0};const u=a.rules.filter(l=>l.type==="facing").map(l=>c[l.criteria]),T=a.rules.filter(l=>l.type==="location").map(l=>l.criteria);let m=Math.floor(Math.random()*i.length),D=!0,F=null,k=[...i];for(;D&&k.length>0;){const l=k[m];let j=[];l.group.forEach(q=>{const A=o[q],J=(A==null?void 0:A.rules.filter($=>$.type==="nogroup"))||[];j.push(J.map($=>$.criteria))}),F=k[m].id;const G=o[F],X=typeof G<"u"&&G!==null&&G!=="",e=j.flat().filter(q=>a.id===q).length>0,n=u.length>0?u[0]!=l.direction:!1,y=T.length>0?!w(l).includes(T[0]):!1;D=X||e||n||y,k=k.filter(q=>q.id!==F),m=Math.floor(Math.random()*k.length)}return{seatId:F,valid:!D,ruleResults:{}}},M=()=>{let a={},o=[...h];b.sort((i,r)=>{var u=i.rules.filter(l=>l.type==="location").length,T=r.rules.filter(l=>l.type==="location").length,m=i.rules.filter(l=>l.type==="facing").length,D=r.rules.filter(l=>l.type==="facing").length,F=i.rules.filter(l=>l.type==="seat").length,k=i.rules.filter(l=>l.type==="seat").length;return F>k||u>T||m>D?-1:r.rules.length-i.rules.length}).forEach(i=>{const{seatId:r,valid:u,ruleResults:T}=E(i,a,o);r!==null&&(i.valid=u,i.empty=!1,i.results=T,a[r]=i,o=o.filter(m=>m.id!==r))}),h.forEach(i=>{i.id in a||(a[i.id]={firstName:"Empty",lastName:"Seat",valid:!0,empty:!0})}),t(3,g=a)},W=async()=>{b=await Le(p)};Re(async()=>{t(2,h=await He());const a=await ke();t(5,v=a.map(i=>({value:i.id,text:i.name}))),await W();let o={};h.forEach(i=>{o[i.id]={firstName:"Empty",lastName:"Seat",valid:!0,empty:!0}}),t(3,g=o)});function K(a){p=a,t(4,p)}function L(){S=this.clientHeight,H=this.clientWidth,t(1,S),t(0,H)}return d.$$.update=()=>{d.$$.dirty&3&&console.log(`Room size: ${H} X ${S}`)},[H,S,h,g,p,v,_,M,W,K,L]}class Ie extends ae{constructor(s){super(),ie(this,s,Fe,De,re,{})}}export{Ie as default};
