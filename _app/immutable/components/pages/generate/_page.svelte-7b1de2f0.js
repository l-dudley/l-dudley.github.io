import{S as se,i as ae,s as ie,L as re,M as ne,a as $,k,q as W,w as oe,N as ce,h as u,c as q,l as T,m as D,r as j,x as fe,n as F,b as M,E as S,y as ue,F as de,O as he,P as pe,f as _e,t as me,z as ve,o as ge,p as A,u as ye,Q as Ee}from"../../../chunks/index-8c652ea8.js";import{g as Se,a as be,b as Re}from"../../../chunks/db-e565effc.js";import{S as He}from"../../../chunks/SelectField-9f11e83a.js";function te(y,a,l){const d=y.slice();return d[13]=a[l],d}function le(y,a){var O,N;let l,d=((O=a[1][a[13].id])==null?void 0:O.firstName)+" "+((N=a[1][a[13].id])==null?void 0:N.lastName),b,m,v=`${a[13].left}px`,h=`${a[13].top}px`;return{key:y,first:null,c(){l=k("div"),b=W(d),m=$(),this.h()},l(c){l=T(c,"DIV",{class:!0});var p=D(l);b=j(p,d),m=q(p),p.forEach(u),this.h()},h(){F(l,"class","seat-box svelte-a2eqnd"),A(l,"left",v),A(l,"top",h),A(l,"background-color",a[4](a[1][a[13].id])),this.first=l},m(c,p){M(c,l,p),S(l,b),S(l,m)},p(c,p){var w,E;a=c,p&3&&d!==(d=((w=a[1][a[13].id])==null?void 0:w.firstName)+" "+((E=a[1][a[13].id])==null?void 0:E.lastName))&&ye(b,d),p&1&&v!==(v=`${a[13].left}px`)&&A(l,"left",v),p&1&&h!==(h=`${a[13].top}px`)&&A(l,"top",h),p&3&&A(l,"background-color",a[4](a[1][a[13].id]))},d(c){c&&u(l)}}}function Le(y){let a,l,d,b,m,v,h,O,N,c,p,w,E,C,K,r,i,t,_,L,g,n=[],I=new Map,R,H,s;function z(e){y[7](e)}let G={fullwidth:"true",options:y[3],onChange:y[6]};y[2]!==void 0&&(G.value=y[2]),c=new He({props:G}),re.push(()=>ne(c,"value",z));let V=y[0];const Q=e=>e[13].id;for(let e=0;e<V.length;e+=1){let o=te(y,V,e),f=Q(o);I.set(f,n[e]=le(f,o))}return{c(){a=$(),l=k("h2"),d=W("Generate Seating Chart"),b=$(),m=k("div"),v=k("div"),h=k("button"),O=W("Generate Chart"),N=$(),oe(c.$$.fragment),w=$(),E=k("div"),C=k("h4"),K=W("Front"),r=$(),i=k("div"),t=k("h4"),_=W("Left"),L=$(),g=k("div");for(let e=0;e<n.length;e+=1)n[e].c();this.h()},l(e){ce("svelte-3kq8j0",document.head).forEach(u),a=q(e),l=T(e,"H2",{class:!0});var f=D(l);d=j(f,"Generate Seating Chart"),f.forEach(u),b=q(e),m=T(e,"DIV",{class:!0});var B=D(m);v=T(B,"DIV",{class:!0});var U=D(v);h=T(U,"BUTTON",{class:!0});var P=D(h);O=j(P,"Generate Chart"),P.forEach(u),U.forEach(u),B.forEach(u),N=q(e),fe(c.$$.fragment,e),w=q(e),E=T(e,"DIV",{class:!0});var J=D(E);C=T(J,"H4",{class:!0});var Z=D(C);K=j(Z,"Front"),Z.forEach(u),r=q(J),i=T(J,"DIV",{class:!0});var X=D(i);t=T(X,"H4",{class:!0});var x=D(t);_=j(x,"Left"),x.forEach(u),L=q(X),g=T(X,"DIV",{class:!0});var ee=D(g);for(let Y=0;Y<n.length;Y+=1)n[Y].l(ee);ee.forEach(u),X.forEach(u),J.forEach(u),this.h()},h(){document.title="Generate Seating Chart",F(l,"class","title is-2"),F(h,"class","button is-primary"),F(v,"class","control"),F(m,"class","field is-grouped"),F(C,"class","title is-4 has-text-centered mb-0 front-heading svelte-a2eqnd"),F(t,"class","title is-4 has-text-centered left-heading svelte-a2eqnd"),F(g,"class","room-container svelte-a2eqnd"),F(i,"class","is-flex"),F(E,"class","box")},m(e,o){M(e,a,o),M(e,l,o),S(l,d),M(e,b,o),M(e,m,o),S(m,v),S(v,h),S(h,O),M(e,N,o),ue(c,e,o),M(e,w,o),M(e,E,o),S(E,C),S(C,K),S(E,r),S(E,i),S(i,t),S(t,_),S(i,L),S(i,g);for(let f=0;f<n.length;f+=1)n[f].m(g,null);R=!0,H||(s=de(h,"click",y[5]),H=!0)},p(e,[o]){const f={};o&8&&(f.options=e[3]),!p&&o&4&&(p=!0,f.value=e[2],he(()=>p=!1)),c.$set(f),o&19&&(V=e[0],n=pe(n,o,Q,1,e,V,I,g,Ee,le,null,te))},i(e){R||(_e(c.$$.fragment,e),R=!0)},o(e){me(c.$$.fragment,e),R=!1},d(e){e&&u(a),e&&u(l),e&&u(b),e&&u(m),e&&u(N),ve(c,e),e&&u(w),e&&u(E);for(let o=0;o<n.length;o+=1)n[o].d();H=!1,s()}}}function ke(y,a,l){let d=[],b=[],m={},v={},h=1,O=[];const N={front:0,right:1,back:2,left:3},c=r=>{let i="white";return r&&(r.valid?r.empty?i="white":i="lightgreen":i="#FF4F40"),i},p=({top:r,left:i})=>{let n=[];return r<200&&n.push("front"),r>600&&n.push("back"),i<700&&n.push("left"),i>700&&n.push("right"),n},w=(r,i,t)=>{const _=r.rules.filter(s=>s.type==="seat").map(s=>s.criteria);if(_&&_.length>0)return{seatId:_[0],valid:!0};const L=r.rules.filter(s=>s.type==="facing").map(s=>N[s.criteria]),g=r.rules.filter(s=>s.type==="location").map(s=>s.criteria);let n=Math.floor(Math.random()*t.length),I=!0,R=null,H=[...t];for(;I&&H.length>0;){const s=H[n];let z=[];s.group.forEach(f=>{const B=i[f],U=(B==null?void 0:B.rules.filter(P=>P.type==="nogroup"))||[];z.push(U.map(P=>P.criteria))}),R=H[n].id;const G=i[R],V=typeof G<"u"&&G!==null&&G!=="",Q=z.flat().filter(f=>r.id===f).length>0,e=L.length>0?L[0]!=s.direction:!1,o=g.length>0?!v[R].includes(g[0]):!1;I=V||Q||e||o,H=H.filter(f=>f.id!==R),n=Math.floor(Math.random()*H.length)}return{seatId:R,valid:!I}},E=()=>{let r={},i=[...d];b.sort((t,_)=>{var L=t.rules.filter(s=>s.type==="location").length,g=_.rules.filter(s=>s.type==="location").length,n=t.rules.filter(s=>s.type==="facing").length,I=_.rules.filter(s=>s.type==="facing").length,R=t.rules.filter(s=>s.type==="seat").length,H=t.rules.filter(s=>s.type==="seat").length;return R>H||L>g||n>I?-1:_.rules.length-t.rules.length}).forEach(t=>{console.log(t);const{seatId:_,valid:L}=w(t,r,i);_!==null&&(t.valid=L,t.empty=!1,r[_]=t,i=i.filter(g=>g.id!==_))}),d.forEach(t=>{t.id in r||(r[t.id]={firstName:"Empty",lastName:"Seat",valid:!0,empty:!0})}),l(1,m=r)},C=async()=>{b=await Re(h)};ge(async()=>{l(0,d=await Se());const r=await be();l(3,O=r.map(t=>({value:t.id,text:t.name}))),await C();let i={};v={},d.forEach(t=>{i[t.id]={firstName:"Empty",lastName:"Seat",valid:!0,empty:!0},v[t.id]=p(t)}),l(1,m=i)});function K(r){h=r,l(2,h)}return[d,m,h,O,c,E,C,K]}class Oe extends se{constructor(a){super(),ae(this,a,ke,Le,ie,{})}}export{Oe as default};
